<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Empleados</title>
    <link rel="stylesheet" href="/private/css-private/empleados.css"> <!-- Enlace al archivo CSS externo -->
</head>

<body>
    <div class="container">
        <table id="clients_table">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Apellido</th>
                    <th>DNI</th>
                    <th>Puesto</th>
                    <th>Teléfono</th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>
        <div class="buttons">
            <button id="addButton">ADD</button>
            <button id="deleteButton">DELETE</button>
        </div>
    </div>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            const getEmployees = async () => {
                const url = 'http://localhost:8080/Buger_Town/Controller?ACTION=EMPLEADO.FIND_ALL';
                const result = await fetch(url);
                const employees = await result.json();
                console.log(employees);
                createEmployeeList(employees);
            }

            const createEmployeeList = (employees) => {
                employees.sort((a, b) => a.Id_Empleado - b.Id_Empleado);
                const employeeTableBody = document.querySelector('tbody');
                employeeTableBody.innerHTML = '';
                employees.forEach(employee => {
                    const { Id_Empleado, nombre, apellido, DNI, puesto, telefono } = employee;
                    const row = `
                        <tr>
                            <td>${Id_Empleado}</td>
                            <td>${nombre}</td>
                            <td>${apellido}</td>
                            <td>${DNI}</td>
                            <td>${puesto}</td>
                            <td>${telefono}</td>
                        </tr>
                    `;
                    employeeTableBody.insertAdjacentHTML('beforeend', row);
                });
            }
            const deleteEmployee = async (event) => {
                const employeeId = event;
                if (confirm(`¿Estás seguro de que quieres eliminar el empleado con ID ${employeeId}?`)) {
                    const url = `http://localhost:8080/Buger_Town/Controller?ACTION=EMPLEADO.DELETE&ID_EMPLEADO=${employeeId}`;
                    try {
                        const response = await fetch(url);
                        if (response.ok) {
                            // Remove the row from the table
                            event.target.closest('tr').remove();
                            console.log(`Empleado con ID ${employeeId} eliminado correctamente.`);
                        } else {
                            console.error('Error al eliminar el empleado.');
                        }
                    } catch (error) {
                        console.error('Error de red:', error);
                    }
                }
            }
            const deleteButton = document.getElementById('deleteButton');
            deleteButton.addEventListener('click', () => {
                const employeeId = prompt('Ingrese el ID del cliente que desea eliminar:');
                if (employeeId !== null && employeeId.trim() !== '') {
                    deleteEmployee(employeeId);
                } else {
                    alert('Debe ingresar un ID válido.');
                }
            });

            const addEmployee = async () => {
                const newId = prompt('Ingrese el ID del nuevo empleado:').trim();
                const newNombre = prompt('Ingrese el nombre del nuevo empleado:').trim();
                const newApellido = prompt('Ingrese el apellido del nuevo empleado:').trim();
                const newDNI = prompt('Ingrese el DNI del nuevo empleado:').trim();
                const newPuesto = prompt('Ingrese el puesto del nuevo empleado:').trim();
                const newTelefono = prompt('Ingrese el teléfono del nuevo empleado:').trim();

                if (newId && newNombre && newApellido && newDNI && newPuesto && newTelefono) {
                    const url = `http://localhost:8080/Buger_Town/Controller?ACTION=EMPLEADO.ADD&ID_EMPLEADO=${newId}&NOMBRE=${newNombre}&APELLIDO=${newApellido}&DNI=${newDNI}&PUESTO=${newPuesto}&TELEFONO=${newTelefono}`;
                    try {
                        const response = await fetch(url);
                        if (response.ok) {
                            const newRow = `
                                <tr data-id="${newId}">
                                    <td>${newId}</td>
                                    <td>${newNombre}</td>
                                    <td>${newApellido}</td>
                                    <td>${newDNI}</td>
                                    <td>${newPuesto}</td>
                                    <td>${newTelefono}</td>
                                </tr>
                            `;
                            document.querySelector('tbody').insertAdjacentHTML('beforeend', newRow);
                            console.log(`Empleado con ID ${newId} añadido correctamente.`);
                        } else {
                            console.error('Error al añadir el empleado.');
                        }
                    } catch (error) {
                        console.error('Error de red:', error);
                    }
                } else {
                    alert('Todos los campos son obligatorios.');
                }
            };

            document.getElementById('addButton').addEventListener('click', addEmployee);

            document.getElementById('deleteButton').addEventListener('click', () => {
                const employeeId = prompt('Ingrese el ID del cliente que desea eliminar:');
                if (employeeId !== null && employeeId.trim() !== '') {
                    deleteEmployee(employeeId);
                } else {
                    alert('Debe ingresar un ID válido.');
                }
            });

            getEmployees();
        });
    </script>
</body>

</html>